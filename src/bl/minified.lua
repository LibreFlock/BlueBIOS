::a::local b,c;local component=component or require("component")local computer=computer or require("computer")local d,e,f;d=component.proxy(component.list("gpu")())e,f=d.getResolution()local g=false;local h=false;local function i(j)if j then if d.getDepth()>1 then d.setBackground(0x9cc3db)d.setForeground(0x003150)else d.setBackground(0xFFFFFF)d.setForeground(0x000000)end else if d.getDepth()>1 then d.setBackground(0x003150)d.setForeground(0x9cc3db)else d.setBackground(0x000000)d.setForeground(0xFFFFFF)end end end;i(false)local k={y=math.ceil(f/2)-2,button_offset=4,button_height=1,opts={},optcount=0}if d.getDepth()>1 then _G.row_2={y=math.ceil(f/2)+2,button_offset=2,button_height=0,opts={"Power off",computer.getArchitecture(),"Internet boot","Rename","Format"},optcount=5}else _G.row_2={y=math.ceil(f/2)+2,button_offset=2,button_height=0,opts={"Halt","Shell","Netboot","Rename","Format"},optcount=5}end;local l=component.list("filesystem")()local m={}local n;k.opts={}if component.list("filesystem")()then for o in pairs(component.list("filesystem"))do local p=component.invoke(o,"getLabel")if p=="tmpfs"then goto q end;p=p~=nil and p or string.sub(o,1,5)m[o]=0;for r,s in ipairs(component.invoke(o,"list","/"))do if s=="init.lua"then m[o]=m[o]+1 elseif s=="OS.lua"then m[o]=m[o]+2 end end;if not n then n=p end;k.opts[o]=p;k.optcount=k.optcount+1::q::end else blue.fn.shell()computer.shutdown(1)end;local t=k;local u=1::v::if component.list("filesystem")()~=l then goto a end;d.fill(1,1,e,f," ")if u<1 then u=t.optcount elseif u>t.optcount then u=1 end;local w=0;local function x(y)local z=""local A={}local B;for r,s in pairs(y.opts)do w=w+1;B=string.rep(" ",y.button_offset)..s..string.rep(" ",y.button_offset)A[#A+1]=B;z=z..B end;w=0;return z,A end;local C,D=x(k)local E,F=x(row_2)if t==k then local G=0;for o,s in pairs(k.opts)do G=G+1;local H=s==string.match(D[u],"^%s*(.-)%s*$")local I=G==u;if H and I then n=o;break end end end;d.set(math.ceil(e/2)-math.ceil(#C/2),k.y,C)d.set(math.ceil(e/2)-math.ceil(#E/2),row_2.y,E)if d.getDepth()>1 then d.set(math.ceil(e/2)-math.ceil(75/2),f,"Use ← ↑ → ↓ to move cursor; Enter to confirm option; CTRL+ALT+C to shutdown")else d.set(math.ceil(e/2)-math.ceil(26/2),f,"Use ← ↑ → ↓ to move cursor")end;if t==k then _G.button_string=D[u]or D[#D]_G.full_string=C;_G.determined_x=math.ceil(e/2)-math.ceil(#C/2)_G.determined_y=k.y;_G.row_opts=D else _G.button_string=F[u]or F[#F]_G.full_string=E;_G.determined_x=math.ceil(e/2)-math.ceil(#E/2)_G.determined_y=row_2.y;_G.row_opts=F end;local J=0;for o,s in ipairs(row_opts)do if s==button_string and o==u then J=J+1;break else J=J+#s end end;i(true)d.set(determined_x+J-1,determined_y,button_string)if t.button_height>0 then for o=1,t.button_height do local K=string.rep(" ",#button_string)d.set(determined_x+J-1,determined_y-o,K)d.set(determined_x+J-1,determined_y+o,K)end end;i(false)repeat local L,r,M,N=computer.pullSignal()if L=="key_down"then if N==200 then t=k elseif N==208 then t=row_2 elseif N==203 then u=u-1 elseif N==205 then u=u+1 elseif N==42 or N==54 then g=true elseif N==58 then h=not h elseif N==29 or N==157 then b=true elseif N==56 or N==184 then c=true elseif N==46 then if b and c then computer.shutdown()end elseif N==28 then if t==k then local O=pcall(component.invoke,n,"getLabel")if not O then goto a end;local K="Booting..."d.setForeground(0xcccccc)d.fill(1,math.ceil(f/2)+5,e,1," ")d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)if blue.vb.boot_drive==n then i(false)break end;local P=component.proxy(n)local p=P.getLabel()local function Q(R)local S=P.open(R)if S then local T=""::U::local V=P.read(S,math.huge)if V then T=T..V;goto U end;P.close(S)return T end end;if not p then p="N/A"end;local W=false;if m[n]==1 then blue.vb.init=Q("/init.lua")W=true elseif m[n]>1 then blue.vb.init=Q("/OS.lua")W=true elseif m[n]==0 then K="Unable to boot; missing boot files"d.fill(1,math.ceil(f/2)+5,e,1," ")d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)i(false)W=false;computer.pullSignal()computer.pullSignal()end;if W then blue.vb.boot_label=p;blue.vb.boot_drive=n;computer.setBootAddress(n)i(false)break end else if u==1 then computer.shutdown()elseif u==2 then blue.fn.shell()elseif u==3 then d.setForeground(0xcccccc)if component.list("internet")()then local X=component.proxy(component.list("internet")())local K="URL: "d.fill(1,math.ceil(f/2)+5,e,1," ")repeat d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)local L,r,M,N=computer.pullSignal()if L=="key_down"then if N==42 or N==54 then g=true elseif N==58 then h=not h elseif N==14 then if#K>5 then K=string.sub(K,1,#K-1)d.fill(1,math.ceil(f/2)+5,e,1," ")end elseif M>31 and M<127 then if g or h then K=K..string.upper(string.char(M))else K=K..string.char(M)end elseif N==28 then d.fill(1,math.ceil(f/2)+5,e,1," ")d.set(math.ceil(e/2)-7,math.ceil(f/2)+5,"Downloading...")local Y=X.request(string.sub(K,6,#K))if Y then local T=""::Z::local V=Y.read()if V then T=T..V;goto Z end;if T and T~=""then local _,a0=pcall(function()return load(T)()end)if _ then goto a else d.fill(1,math.ceil(f/2)+5,e,1," ")d.set(math.ceil(e/2)-math.ceil(#a0/2),math.ceil(f/2)+5,a0)computer.pullSignal()computer.pullSignal()break end else d.fill(1,math.ceil(f/2)+5,e,1," ")K="An error occured."d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)end else d.fill(1,math.ceil(f/2)+5,e,1," ")K="An error occured."d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)computer.pullSignal()computer.pullSignal()break end end elseif L=="key_up"then if N==42 or N==54 then g=false end elseif L=="clipboard"then K=K..M end until false;i(false)else d.fill(1,math.ceil(f/2)+5,e,1," ")local K="This feature requires an internet card to run."d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)computer.pullSignal()computer.pullSignal()end;i(false)elseif u==4 then local K="New label: "d.fill(1,math.ceil(f/2)+5,e,1," ")repeat d.setForeground(0xcccccc)d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)local L,r,M,N=computer.pullSignal()if L=="key_down"then if N==42 or N==54 then g=true elseif N==58 then h=not h elseif N==14 then if#K>11 then K=string.sub(K,1,#K-1)d.fill(1,math.ceil(f/2)+5,e,1," ")end elseif M>31 and M<127 then if g or h then K=K..string.upper(string.char(M))else K=K..string.char(M)end elseif N==28 then local p=string.sub(K,12,#K)local a1,a0;if p==""then a1,a0=pcall(component.invoke,n,"setLabel",nil)else a1,a0=pcall(component.invoke,n,"setLabel",p)end;if not a1 then d.fill(1,math.ceil(f/2)+5,e,1," ")K="An error has occured: "..a0;d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)computer.pullSignal()computer.pullSignal()i(false)break else i(false)break end end elseif L=="key_up"then if N==42 or N==54 then g=false end elseif L=="clipboard"then K=K..M end until false;goto a elseif u==5 then d.fill(1,math.ceil(f/2)+5,e,1," ")d.setForeground(0xcccccc)local p=component.invoke(n,"getLabel")local K="Format "..(p~=nil and p or"N/A").." ("..n..")? (Y/N)"d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)repeat local L,r,M=computer.pullSignal()if L=="key_down"then if string.char(M)=="y"then d.fill(1,math.ceil(f/2)+5,e,1," ")K="Formatting..."local a2=computer.uptime()d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)local a3=component.proxy(n)local function a4(a5)for r,o in ipairs(a3.list(a5~=nil and a5 or"/"))do if string.match(o,"/$")~=nil then a4("/"..(a5~=nil and a5 or"")..o)else a3.remove("/"..(a5~=nil and a5 or"")..o)end end end;a3.setLabel(nil)a4()if a2==computer.uptime()then K="Formatted in less than a second"else K="Formatted in "..computer.uptime()-a2 .." seconds"end;d.set(math.ceil(e/2)-math.ceil(#K/2),math.ceil(f/2)+5,K)computer.pullSignal()computer.pullSignal()break else break end end until false;goto a end end end elseif L=="key_up"then if N==42 or N==54 then g=false elseif N==29 or N==157 then b=false elseif N==56 or N==184 then c=false end end;goto v until false