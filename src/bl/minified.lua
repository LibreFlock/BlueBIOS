::a::local component=component or require("component")local computer=computer or require("computer")local b,c,d;b=component.proxy(component.list("gpu")())c,d=b.getResolution()local e=false;local f=false;local function g(h)if h then if b.getDepth()>1 then b.setBackground(0x9cc3db)b.setForeground(0x003150)else b.setBackground(0xFFFFFF)b.setForeground(0x000000)end else if b.getDepth()>1 then b.setBackground(0x003150)b.setForeground(0x9cc3db)else b.setBackground(0x000000)b.setForeground(0xFFFFFF)end end end;g(false)local i={y=math.ceil(d/2)-2,button_offset=4,button_height=1,opts={},optcount=0}if b.getDepth()>1 then _G.row_2={y=math.ceil(d/2)+2,button_offset=2,button_height=0,opts={"Power off",computer.getArchitecture(),"Internet boot","Rename","Format"},optcount=5}else _G.row_2={y=math.ceil(d/2)+2,button_offset=2,button_height=0,opts={"Halt","Shell","Netboot","Rename","Format"},optcount=5}end;local j=component.list("filesystem")()local k={}local l;i.opts={}if component.list("filesystem")()then for m in pairs(component.list("filesystem"))do local n=component.invoke(m,"getLabel")if n=="tmpfs"then goto o end;n=n~=nil and n or string.sub(m,1,5)k[m]=0;for p,q in ipairs(component.invoke(m,"list","/"))do if q=="init.lua"then k[m]=k[m]+1 elseif q=="OS.lua"then k[m]=k[m]+2 end end;if not l then l=n end;i.opts[m]=n;i.optcount=i.optcount+1::o::end else blue.fn.shell()computer.shutdown(1)end;local r=i;local s=1::t::if component.list("filesystem")()~=j then goto a end;b.fill(1,1,c,d," ")if s<1 then b.set(1,d,tostring(true))s=r.optcount elseif s>r.optcount then b.set(1,d,tostring(false))s=1 end;local u=0;local function v(w)local x=""local y={}local z;for p,q in pairs(w.opts)do u=u+1;z=string.rep(" ",w.button_offset)..q..string.rep(" ",w.button_offset)y[#y+1]=z;x=x..z end;u=0;return x,y end;local A,B=v(i)local C,D=v(row_2)if r==i then local E=0;for m,q in pairs(i.opts)do E=E+1;local F=q==string.match(B[s],"^%s*(.-)%s*$")local G=E==s;if F and G then l=m;break end end end;b.set(math.ceil(c/2)-math.ceil(#A/2),i.y,A)b.set(math.ceil(c/2)-math.ceil(#C/2),row_2.y,C)if b.getDepth()>1 then b.set(math.ceil(c/2)-math.ceil(75/2),d,"Use ← ↑ → ↓ to move cursor; Enter to confirm option; CTRL+ALT+C to shutdown")else b.set(math.ceil(c/2)-math.ceil(26/2),d,"Use ← ↑ → ↓ to move cursor")end;if r==i then _G.button_string=B[s]or B[#B]_G.full_string=A;_G.determined_x=math.ceil(c/2)-math.ceil(#A/2)_G.determined_y=i.y else _G.button_string=D[s]or D[#D]_G.full_string=C;_G.determined_x=math.ceil(c/2)-math.ceil(#C/2)_G.determined_y=row_2.y end;local H;if r==i then H=string.find(full_string,button_string)else H=string.find(full_string,button_string)end;g(true)b.set(determined_x+H-1,determined_y,button_string)if r.button_height>0 then for m=1,r.button_height do local I=string.rep(" ",#button_string)b.set(determined_x+H-1,determined_y-m,I)b.set(determined_x+H-1,determined_y+m,I)end end;g(false)repeat local J,p,p,K=computer.pullSignal()if J=="key_down"then if K==200 then r=i elseif K==208 then r=row_2 elseif K==203 then s=s-1 elseif K==205 then s=s+1 elseif K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==28 then if r==i then local I="Booting..."b.setForeground(0xcccccc)b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)if blue.vb.boot_drive==l then g(false)break end;local L=component.proxy(l)local n=L.getLabel()local function M(N)local O=L.open(N)if O then local P=""::Q::local R=L.read(O,math.huge)if R then P=P..R;goto Q end;L.close(O)return P end end;if not n then n="N/A"end;local S=false;if k[l]==1 then blue.vb.init=M("/init.lua")S=true elseif k[l]>1 then blue.vb.init=M("/OS.lua")S=true elseif k[l]==0 then I="Unable to boot; missing boot files"b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)g(false)S=false;computer.pullSignal()computer.pullSignal()end;if S then blue.vb.boot_label=n;blue.vb.boot_drive=l;computer.setBootAddress(l)g(false)break end else if s==1 then computer.shutdown()elseif s==2 then blue.fn.shell()elseif s==3 then b.setForeground(0xcccccc)if component.list("internet")()then local T=component.proxy(component.list("internet")())local I="URL: "b.fill(1,math.ceil(d/2)+5,c,1," ")repeat b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local J,p,U,K=computer.pullSignal()if J=="key_down"then if K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==14 then if#I>5 then I=string.sub(I,1,#I-1)b.fill(1,math.ceil(d/2)+5,c,1," ")end elseif U>31 and U<127 then if e or f then I=I..string.upper(string.char(U))else I=I..string.char(U)end elseif K==28 then b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-7,math.ceil(d/2)+5,"Downloading...")local V=T.request(string.sub(I,6,#I))if V then local P=""::W::local R=V.read()if R then P=P..R;goto W end;if P and P~=""then local X,Y=pcall(function()return load(P)()end)if X then goto a else b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#Y/2),math.ceil(d/2)+5,Y)computer.pullSignal()computer.pullSignal()break end else b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error occured."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)end else b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error occured."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()break end end elseif J=="key_up"then if K==42 or K==54 then e=false end elseif J=="clipboard"then I=I..U end until false;g(false)else b.fill(1,math.ceil(d/2)+5,c,1," ")local I="This feature requires an internet card to run."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()end;g(false)elseif s==4 then local I="New label: "b.fill(1,math.ceil(d/2)+5,c,1," ")repeat b.setForeground(0xcccccc)b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local J,p,U,K=computer.pullSignal()if J=="key_down"then if K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==14 then if#I>11 then I=string.sub(I,1,#I-1)b.fill(1,math.ceil(d/2)+5,c,1," ")end elseif U>31 and U<127 then if e or f then I=I..string.upper(string.char(U))else I=I..string.char(U)end elseif K==28 then local n=string.sub(I,12,#I)local Z,Y;if n==""then Z,Y=pcall(component.invoke,l,"setLabel",nil)else Z,Y=pcall(component.invoke,l,"setLabel",n)end;if not Z then b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error has occured: "..Y;b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()g(false)break else g(false)break end end elseif J=="key_up"then if K==42 or K==54 then e=false end elseif J=="clipboard"then I=I..U end until false;goto a elseif s==5 then b.fill(1,math.ceil(d/2)+5,c,1," ")b.setForeground(0xcccccc)local n=component.invoke(l,"getLabel")local I="Format "..(n~=nil and n or"N/A").." ("..l..")? (Y/N)"b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)repeat local J,p,U=computer.pullSignal()if J=="key_down"then if string.char(U)=="y"then b.fill(1,math.ceil(d/2)+5,c,1," ")I="Formatting..."local _=computer.uptime()b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local a0=component.proxy(l)local function a1(a2)for p,m in ipairs(a0.list(a2~=nil and a2 or"/"))do if string.match(m,"/$")~=nil then a1("/"..(a2~=nil and a2 or"")..m)else a0.remove("/"..(a2~=nil and a2 or"")..m)end end end;a0.setLabel(nil)a1()if _==computer.uptime()then I="Formatted in less than a second"else I="Formatted in "..computer.uptime()-_.." seconds"end;b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()break else break end end until false;goto a end end end elseif J=="key_up"then if K==42 or K==54 then e=false end end;goto t until false