::a::local component=component or require("component")local computer=computer or require("computer")local b,c,d;b=component.proxy(component.list("gpu")())c,d=b.getResolution()local e=false;local f=false;local function g(h)if h then if b.getDepth()>1 then b.setBackground(0x9cc3db)b.setForeground(0x003150)else b.setBackground(0xFFFFFF)b.setForeground(0x000000)end else if b.getDepth()>1 then b.setBackground(0x003150)b.setForeground(0x9cc3db)else b.setBackground(0x000000)b.setForeground(0xFFFFFF)end end end;g(false)local i={y=math.ceil(d/2)-2,button_offset=4,button_height=1,opts={},optcount=0}if b.getDepth()>1 then _G.row_2={y=math.ceil(d/2)+2,button_offset=2,button_height=0,opts={"Power off",computer.getArchitecture(),"Internet boot","Rename","Format"},optcount=5}else _G.row_2={y=math.ceil(d/2)+2,button_offset=2,button_height=0,opts={"Halt","Shell","Netboot","Rename","Format"},optcount=5}end;local j=component.list("filesystem")()local k={}local l;i.opts={}if component.list("filesystem")()then for m in pairs(component.list("filesystem"))do local n=component.invoke(m,"getLabel")if n=="tmpfs"then goto o end;n=n~=nil and n or string.sub(m,1,5)k[m]=0;for p,q in ipairs(component.invoke(m,"list","/"))do if q=="init.lua"then k[m]=k[m]+1 elseif q=="OS.lua"then k[m]=k[m]+2 end end;if not l then l=n end;i.opts[m]=n;i.optcount=i.optcount+1::o::end else blue.fn.shell()computer.shutdown(1)end;local r=i;local s=1::t::if component.list("filesystem")()~=j then goto a end;b.fill(1,1,c,d," ")if s<1 then s=r.optcount elseif s>r.optcount then s=1 end;local u=0;local function v(w)local x=""local y={}local z;for p,q in pairs(w.opts)do u=u+1;z=string.rep(" ",w.button_offset)..q..string.rep(" ",w.button_offset)y[#y+1]=z;x=x..z end;u=0;return x,y end;local A,B=v(i)local C,D=v(row_2)if r==i then local E=0;for m,q in pairs(i.opts)do E=E+1;local F=q==string.match(B[s],"^%s*(.-)%s*$")local G=E==s;if F and G then l=m;break end end end;b.set(math.ceil(c/2)-math.ceil(#A/2),i.y,A)b.set(math.ceil(c/2)-math.ceil(#C/2),row_2.y,C)if b.getDepth()>1 then b.set(math.ceil(c/2)-math.ceil(75/2),d,"Use ← ↑ → ↓ to move cursor; Enter to confirm option; CTRL+ALT+C to shutdown")else b.set(math.ceil(c/2)-math.ceil(26/2),d,"Use ← ↑ → ↓ to move cursor")end;if r==i then _G.button_string=B[s]or B[#B]_G.full_string=A;_G.determined_x=math.ceil(c/2)-math.ceil(#A/2)_G.determined_y=i.y;_G.row_opts=B else _G.button_string=D[s]or D[#D]_G.full_string=C;_G.determined_x=math.ceil(c/2)-math.ceil(#C/2)_G.determined_y=row_2.y;_G.row_opts=D end;local H=0;for m,q in ipairs(row_opts)do if q==button_string and m==s then H=H+1;break else H=H+#q end end;g(true)b.set(determined_x+H-1,determined_y,button_string)if r.button_height>0 then for m=1,r.button_height do local I=string.rep(" ",#button_string)b.set(determined_x+H-1,determined_y-m,I)b.set(determined_x+H-1,determined_y+m,I)end end;g(false)repeat local J,p,p,K=computer.pullSignal()if J=="key_down"then if K==200 then r=i elseif K==208 then r=row_2 elseif K==203 then s=s-1 elseif K==205 then s=s+1 elseif K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==28 then if r==i then local L=pcall(component.invoke,l,"getLabel")if not L then goto a end;local I="Booting..."b.setForeground(0xcccccc)b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)if blue.vb.boot_drive==l then g(false)break end;local M=component.proxy(l)local n=M.getLabel()local function N(O)local P=M.open(O)if P then local Q=""::R::local S=M.read(P,math.huge)if S then Q=Q..S;goto R end;M.close(P)return Q end end;if not n then n="N/A"end;local T=false;if k[l]==1 then blue.vb.init=N("/init.lua")T=true elseif k[l]>1 then blue.vb.init=N("/OS.lua")T=true elseif k[l]==0 then I="Unable to boot; missing boot files"b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)g(false)T=false;computer.pullSignal()computer.pullSignal()end;if T then blue.vb.boot_label=n;blue.vb.boot_drive=l;computer.setBootAddress(l)g(false)break end else if s==1 then computer.shutdown()elseif s==2 then blue.fn.shell()elseif s==3 then b.setForeground(0xcccccc)if component.list("internet")()then local U=component.proxy(component.list("internet")())local I="URL: "b.fill(1,math.ceil(d/2)+5,c,1," ")repeat b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local J,p,V,K=computer.pullSignal()if J=="key_down"then if K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==14 then if#I>5 then I=string.sub(I,1,#I-1)b.fill(1,math.ceil(d/2)+5,c,1," ")end elseif V>31 and V<127 then if e or f then I=I..string.upper(string.char(V))else I=I..string.char(V)end elseif K==28 then b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-7,math.ceil(d/2)+5,"Downloading...")local W=U.request(string.sub(I,6,#I))if W then local Q=""::X::local S=W.read()if S then Q=Q..S;goto X end;if Q and Q~=""then local Y,Z=pcall(function()return load(Q)()end)if Y then goto a else b.fill(1,math.ceil(d/2)+5,c,1," ")b.set(math.ceil(c/2)-math.ceil(#Z/2),math.ceil(d/2)+5,Z)computer.pullSignal()computer.pullSignal()break end else b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error occured."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)end else b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error occured."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()break end end elseif J=="key_up"then if K==42 or K==54 then e=false end elseif J=="clipboard"then I=I..V end until false;g(false)else b.fill(1,math.ceil(d/2)+5,c,1," ")local I="This feature requires an internet card to run."b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()end;g(false)elseif s==4 then local I="New label: "b.fill(1,math.ceil(d/2)+5,c,1," ")repeat b.setForeground(0xcccccc)b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local J,p,V,K=computer.pullSignal()if J=="key_down"then if K==42 or K==54 then e=true elseif K==58 then f=not f elseif K==14 then if#I>11 then I=string.sub(I,1,#I-1)b.fill(1,math.ceil(d/2)+5,c,1," ")end elseif V>31 and V<127 then if e or f then I=I..string.upper(string.char(V))else I=I..string.char(V)end elseif K==28 then local n=string.sub(I,12,#I)local _,Z;if n==""then _,Z=pcall(component.invoke,l,"setLabel",nil)else _,Z=pcall(component.invoke,l,"setLabel",n)end;if not _ then b.fill(1,math.ceil(d/2)+5,c,1," ")I="An error has occured: "..Z;b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()g(false)break else g(false)break end end elseif J=="key_up"then if K==42 or K==54 then e=false end elseif J=="clipboard"then I=I..V end until false;goto a elseif s==5 then b.fill(1,math.ceil(d/2)+5,c,1," ")b.setForeground(0xcccccc)local n=component.invoke(l,"getLabel")local I="Format "..(n~=nil and n or"N/A").." ("..l..")? (Y/N)"b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)repeat local J,p,V=computer.pullSignal()if J=="key_down"then if string.char(V)=="y"then b.fill(1,math.ceil(d/2)+5,c,1," ")I="Formatting..."local a0=computer.uptime()b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)local a1=component.proxy(l)local function a2(a3)for p,m in ipairs(a1.list(a3~=nil and a3 or"/"))do if string.match(m,"/$")~=nil then a2("/"..(a3~=nil and a3 or"")..m)else a1.remove("/"..(a3~=nil and a3 or"")..m)end end end;a1.setLabel(nil)a2()if a0==computer.uptime()then I="Formatted in less than a second"else I="Formatted in "..computer.uptime()-a0 .." seconds"end;b.set(math.ceil(c/2)-math.ceil(#I/2),math.ceil(d/2)+5,I)computer.pullSignal()computer.pullSignal()break else break end end until false;goto a end end end elseif J=="key_up"then if K==42 or K==54 then e=false end end;goto t until false