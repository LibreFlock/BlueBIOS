local component=component;local computer=computer;local a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;a=component.proxy(component.list("gpu")())a.bind(component.proxy(component.list("screen")()).address)b,c=a.getResolution()a.setForeground(0x9cc3db)a.setBackground(0x003150)d=function(F,G,H,I)if I then return pcall(component.invoke,F,G,H,I)else return pcall(component.invoke,F,G,H)end end;function e(F,J)if J then n,o=d(F,"open",J)else n,o=d(F,"open","/init.lua")end;if n then v=""::K::_,D=d(F,"read",o,math.maxinteger)if D then v=v..D;goto K end;d(F,"close",o)return v else return false end end;function g(L)a.fill(1,1,b,c," ")return a.set(math.ceil(b/2-#L/2),math.ceil(c/2),L)end;function w()_G.buffer={}_G.print=function(M)for _ in string.gmatch(tostring(M),"[^\r\n]+")do if#tostring(M)>b then for N=1,math.ceil(#tostring(M)/b)do buffer[#buffer+1]=string.sub(tostring(M),N==1 and 1 or b*(N-1),b*N)end else buffer[#buffer+1]=tostring(M)end end end;buffer[1]="bootloader> "x=false;y=false;B=""::O::g("")for N=1,c do if buffer[#buffer-N+1]then a.set(1,c-N+1,buffer[#buffer-N+1])end end;r,_,A,s=computer.pullSignal(1)if not A then if r=="key_down"then if s==42 or s==54 then x=true elseif s==58 then y=not y end elseif r=="key_up"then if s==42 or s==54 then x=false end end else if r=="key_down"then if s==28 then if B=="exit"then return elseif B=="shutdown"then computer.shutdown()end;m,C=pcall(load(B))if C then for _ in string.gmatch(C,"[^\r\n]+")do if#C>b then for N=1,math.ceil(#C/b)do buffer[#buffer+1]=string.sub(C,N==1 and 1 or b*(N-1),b*N)end else buffer[#buffer+1]=C end end end;buffer[#buffer+1]="bootloader> "B=""goto O elseif s==14 then if#buffer[#buffer]>12 then B=string.sub(B,1,#B-1)buffer[#buffer]=string.sub(buffer[#buffer],1,#buffer[#buffer]-1)end;goto O elseif A<127 and A>31 then z=string.char(A)if x or y then z=string.upper(z)end;buffer[#buffer]=buffer[#buffer]..z;B=B..z end end end;goto O end;g("Hold ALT to stay in bootloader")h=component.proxy(component.list("eeprom")())function computer.getBootAddress()return h.getData()end;function computer.setBootAddress(P)return h.setData(P)end;i=computer.getBootAddress()j=e(i)if j and component.invoke(i,"getLabel")~="tmpfs"then l=component.invoke(k,"getLabel")k=i else for N in pairs(component.list("filesystem"))do j=e(N)k=N;if j then computer.setBootAddress(N)break end end end::Q::m=component.invoke(k,"list","/bios/plugins/")if m then for _,R in ipairs(m)do if not R:match(".*/$")then o=component.invoke(k,"open","/bios/plugins/"..R)load(component.invoke(k,"read",o,math.huge)or"")()end end else n=pcall(component.invoke,k,"makeDirectory","/bios/plugins/")if n then goto Q end end;p=computer.uptime()if not j then goto q end;if not q then repeat r,_,_,s=computer.pullSignal(1)if r=="key_down"and s==(56 or 184)then q=true;break end until p+1<=computer.uptime()end::S::if not q then g("Booting to "..(l~=nil and l or"N/A").." ("..k..")")return load(j)()end::q::q=false;f=e(i,"/bios/bl.bin")if f or E then goto T end;if k then for N in component.list("filesystem")do f=e(N,"/bios/bl.bin")if f then break end end end;if not f then t=component.list("internet")()if t then if component.invoke(t,"isHttpEnabled")then u=component.invoke(t,"request","https://raw.githubusercontent.com/OpenGCX/BlueBIOS/main/binaries/bl.bin")if u then v=""::K::D=u.read()if D then v=v..D;goto K end;if not v==""and v then f=v;if k then n,o=d(k,"open","/bios/bl.bin","w")if n then d(k,"write",o,f)d(k,"close",o)end end end end end end end::T::if f and not E then load(f)()else g("")w()end;if j then goto S else computer.shutdown(1)end